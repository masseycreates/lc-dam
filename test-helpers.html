<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lottery Service Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .passed { border-color: green; background: #e8f5e8; }
        .failed { border-color: red; background: #ffe8e8; }
        .test-button { margin: 5px; padding: 10px; background: #007cba; color: white; border: none; cursor: pointer; }
        .test-button:hover { background: #005a87; }
        .loading { color: #666; font-style: italic; }
        .console-log { background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>Lottery Service Test</h1>
    <div id="test-results"></div>
    
    <h2>Manual Tests</h2>
    <button class="test-button" onclick="testNumberGeneration('random')">Test Random Generation</button>
    <button class="test-button" onclick="testNumberGeneration('frequency')">Test Frequency Generation</button>
    <button class="test-button" onclick="testNumberGeneration('hybrid')">Test Hybrid Generation</button>
    <button class="test-button" onclick="testNumberGeneration('hot-cold')">Test Hot-Cold Generation</button>
    <button class="test-button" onclick="testServiceInitialization()">Test Service Initialization</button>
    <button class="test-button" onclick="testUserSelection()">Test User Selection</button>
    <button class="test-button" onclick="testNumberAnalysis()">Test Number Analysis</button>
    <button class="test-button" onclick="clearResults()">Clear Results</button>

    <div id="console-output"></div>

    <!-- Load utility modules -->
    <script src="src/utils/constants.js"></script>
    <script src="src/utils/helpers.js"></script>
    <script src="src/utils/LotteryAlgorithms.js"></script>
    
    <!-- Load services -->
    <script src="src/services/apiService.js"></script>
    <script src="src/services/lotteryService.js"></script>

    <script>
        let testResults = [];
        let consoleOutput = [];
        
        // Override console.log to capture output
        const originalConsoleLog = console.log;
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            consoleOutput.push(args.join(' '));
            updateConsoleDisplay();
        };
        
        function addTestResult(test, passed, details) {
            testResults.push({ test, passed, details, timestamp: new Date().toLocaleTimeString() });
            updateDisplay();
        }
        
        function updateDisplay() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<h2>Test Results:</h2>' + 
                testResults.map(result => 
                    `<div class="test-result ${result.passed ? 'passed' : 'failed'}">
                        <strong>${result.test}:</strong> ${result.passed ? 'PASSED' : 'FAILED'} <small>(${result.timestamp})</small><br>
                        <small>${result.details}</small>
                    </div>`
                ).join('');
        }
        
        function updateConsoleDisplay() {
            const consoleDiv = document.getElementById('console-output');
            consoleDiv.innerHTML = '<h3>Console Output:</h3><div class="console-log">' + 
                consoleOutput.slice(-20).join('\n') + '</div>';
        }
        
        function clearResults() {
            testResults = [];
            consoleOutput = [];
            updateDisplay();
            updateConsoleDisplay();
        }
        
        function runBasicTests() {
            console.log('Starting basic tests...');
            
            // Test 1: Check if performanceMetrics is initialized
            addTestResult(
                'Performance Metrics Initialization',
                window.performanceMetrics && window.performanceMetrics.loadTimes,
                window.performanceMetrics ? 'Initialized' : 'Not initialized'
            );
            
            // Test 2: Check if trackPerformance is available
            addTestResult(
                'trackPerformance Function',
                typeof window.trackPerformance === 'function',
                typeof window.trackPerformance
            );
            
            // Test 3: Check if handleApiError is available
            addTestResult(
                'handleApiError Function',
                typeof window.handleApiError === 'function',
                typeof window.handleApiError
            );

            // Test 4: Test trackPerformance function
            try {
                window.trackPerformance('test_operation', performance.now() - 100);
                addTestResult(
                    'trackPerformance Execution',
                    true,
                    'Function executed without error'
                );
            } catch (error) {
                addTestResult(
                    'trackPerformance Execution',
                    false,
                    error.message
                );
            }

            // Test 7: Check algorithm methods
            if (window.lotteryService && window.lotteryService.algorithms) {
                const algorithms = window.lotteryService.algorithms;
                addTestResult(
                    'Algorithm Methods',
                    typeof algorithms.getAlgorithm === 'function' &&
                    typeof algorithms.algorithms.frequency === 'function' &&
                    typeof algorithms.algorithms.hybrid === 'function',
                    `getAlgorithm: ${typeof algorithms.getAlgorithm}, frequency: ${typeof algorithms.algorithms.frequency}, hybrid: ${typeof algorithms.algorithms.hybrid}`
                );
            } else {
                addTestResult(
                    'Algorithm Methods',
                    false,
                    'Lottery service or algorithms not available'
                );
            }

            // Test 8: Check initialize method
            addTestResult(
                'API Service',
                window.apiService && typeof window.apiService.makeApiCall === 'function',
                window.apiService ? 'Initialized' : 'Not initialized'
            );
            
            addTestResult(
                'Lottery Service',
                window.lotteryService && typeof window.lotteryService.generateNumbers === 'function',
                window.lotteryService ? 'Initialized' : 'Not initialized'
            );
            
            // Test 6: Check LotteryAlgorithms
            addTestResult(
                'LotteryAlgorithms Class',
                window.LotteryAlgorithms && typeof window.LotteryAlgorithms === 'function',
                window.LotteryAlgorithms ? 'Available' : 'Not available'
            );
            
            // Test 7: Check algorithm methods
            if (window.lotteryService && window.lotteryService.algorithms) {
                const algorithms = window.lotteryService.algorithms;
                addTestResult(
                    'Algorithm Methods',
                    typeof algorithms.random === 'function' && 
                    typeof algorithms.frequency === 'function' &&
                    typeof algorithms.hybrid === 'function',
                    `random: ${typeof algorithms.random}, frequency: ${typeof algorithms.frequency}, hybrid: ${typeof algorithms.hybrid}`
                );
            } else {
                addTestResult(
                    'Algorithm Methods',
                    false,
                    'Lottery service or algorithms not available'
                );
            }
            
            // Test 8: Check initialize method
            addTestResult(
                'Initialize Method',
                window.lotteryService && typeof window.lotteryService.initialize === 'function',
                window.lotteryService ? `initialize: ${typeof window.lotteryService.initialize}` : 'Service not available'
            );
            
            // Test 9: Check service methods
            if (window.lotteryService) {
                const methods = ['generateNumbers', 'saveUserSelection', 'analyzeNumbers', 'getCurrentDrawing'];
                const methodsExist = methods.every(method => typeof window.lotteryService[method] === 'function');
                addTestResult(
                    'Service Methods',
                    methodsExist,
                    methods.map(method => `${method}: ${typeof window.lotteryService[method]}`).join(', ')
                );
            }
        }
        
        async function testServiceInitialization() {
            try {
                console.log('Testing service initialization...');
                
                if (!window.lotteryService) {
                    addTestResult('Service Initialization Test', false, 'Lottery service not available');
                    return;
                }
                
                const result = await window.lotteryService.initialize();
                addTestResult(
                    'Service Initialization Test',
                    result.success,
                    result.success ? 'Service initialized successfully' : `Error: ${result.error}`
                );
            } catch (error) {
                addTestResult(
                    'Service Initialization Test',
                    false,
                    `Exception: ${error.message}`
                );
            }
        }
        
        async function testNumberGeneration(algorithm) {
            try {
                console.log(`Testing ${algorithm} generation...`);
                
                if (!window.lotteryService) {
                    addTestResult(
                        `${algorithm} Generation`,
                        false,
                        'Lottery service not available'
                    );
                    return;
                }
                
                const result = await window.lotteryService.generateNumbers(algorithm, 3);
                
                addTestResult(
                    `${algorithm} Generation`,
                    result.success && result.data && Array.isArray(result.data),
                    result.success ? 
                        `Generated ${result.data.length} sets: ${JSON.stringify(result.data[0]?.numbers)} + ${result.data[0]?.powerball}` :
                        `Error: ${result.error}`
                );
            } catch (error) {
                addTestResult(
                    `${algorithm} Generation`,
                    false,
                    `Exception: ${error.message}`
                );
            }
        }
        
        async function testUserSelection() {
            try {
                console.log('Testing user selection...');
                
                if (!window.lotteryService) {
                    addTestResult('User Selection Test', false, 'Lottery service not available');
                    return;
                }
                
                const testNumbers = [1, 15, 23, 42, 67];
                const testPowerball = 12;
                
                const result = window.lotteryService.saveUserSelection(testNumbers, testPowerball);
                
                addTestResult(
                    'User Selection Test',
                    result.success,
                    result.success ? 
                        `Saved selection: ${testNumbers.join(', ')} + ${testPowerball}` :
                        `Error: ${result.error}`
                );
            } catch (error) {
                addTestResult(
                    'User Selection Test',
                    false,
                    `Exception: ${error.message}`
                );
            }
        }
        
        async function testNumberAnalysis() {
            try {
                console.log('Testing number analysis...');
                
                if (!window.lotteryService) {
                    addTestResult('Number Analysis Test', false, 'Lottery service not available');
                    return;
                }
                
                const testNumbers = [5, 12, 28, 35, 49];
                const testPowerball = 8;
                
                const result = await window.lotteryService.analyzeNumbers(testNumbers, testPowerball);
                
                addTestResult(
                    'Number Analysis Test',
                    result.success,
                    result.success ? 
                        `Analysis completed for: ${testNumbers.join(', ')} + ${testPowerball}` :
                        `Error: ${result.error}`
                );
            } catch (error) {
                addTestResult(
                    'Number Analysis Test',
                    false,
                    `Exception: ${error.message}`
                );
            }
        }
        
        // Run tests when page loads
        window.addEventListener('load', () => {
            // Add a delay to ensure all scripts are loaded
            setTimeout(() => {
                console.log('Running basic tests...');
                runBasicTests();
            }, 500);
        });
    </script>
</body>
</html>