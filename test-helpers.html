<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lottery Service Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .passed { border-color: green; background: #e8f5e8; }
        .failed { border-color: red; background: #ffe8e8; }
        .test-button { margin: 5px; padding: 10px; background: #007cba; color: white; border: none; cursor: pointer; }
        .test-button:hover { background: #005a87; }
    </style>
</head>
<body>
    <h1>Lottery Service Test</h1>
    <div id="test-results"></div>
    
    <h2>Manual Tests</h2>
    <button class="test-button" onclick="testNumberGeneration('random')">Test Random Generation</button>
    <button class="test-button" onclick="testNumberGeneration('frequency')">Test Frequency Generation</button>
    <button class="test-button" onclick="testNumberGeneration('hybrid')">Test Hybrid Generation</button>
    <button class="test-button" onclick="testNumberGeneration('hot-cold')">Test Hot-Cold Generation</button>

    <!-- Load utility modules -->
    <script src="src/utils/constants.js"></script>
    <script src="src/utils/helpers.js"></script>
    <script src="src/utils/LotteryAlgorithms.js"></script>
    
    <!-- Load services -->
    <script src="src/services/apiService.js"></script>
    <script src="src/services/lotteryService.js"></script>

    <script>
        let testResults = [];
        
        function addTestResult(test, passed, details) {
            testResults.push({ test, passed, details });
            updateDisplay();
        }
        
        function updateDisplay() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<h2>Test Results:</h2>' + 
                testResults.map(result => 
                    `<div class="test-result ${result.passed ? 'passed' : 'failed'}">
                        <strong>${result.test}:</strong> ${result.passed ? 'PASSED' : 'FAILED'}<br>
                        <small>${result.details}</small>
                    </div>`
                ).join('');
        }
        
        function runBasicTests() {
            // Test 1: Check if performanceMetrics is initialized
            addTestResult(
                'Performance Metrics Initialization',
                window.performanceMetrics && window.performanceMetrics.loadTimes,
                window.performanceMetrics ? 'Initialized' : 'Not initialized'
            );
            
            // Test 2: Check if trackPerformance is available
            addTestResult(
                'trackPerformance Function',
                typeof window.trackPerformance === 'function',
                typeof window.trackPerformance
            );
            
            // Test 3: Check if handleApiError is available
            addTestResult(
                'handleApiError Function',
                typeof window.handleApiError === 'function',
                typeof window.handleApiError
            );
            
            // Test 4: Test trackPerformance function
            try {
                window.trackPerformance('test_operation', performance.now() - 100);
                addTestResult(
                    'trackPerformance Execution',
                    true,
                    'Function executed without error'
                );
            } catch (error) {
                addTestResult(
                    'trackPerformance Execution',
                    false,
                    error.message
                );
            }
            
            // Test 5: Check if services are initialized
            addTestResult(
                'API Service',
                window.apiService && typeof window.apiService.makeApiCall === 'function',
                window.apiService ? 'Initialized' : 'Not initialized'
            );
            
            addTestResult(
                'Lottery Service',
                window.lotteryService && typeof window.lotteryService.generateNumbers === 'function',
                window.lotteryService ? 'Initialized' : 'Not initialized'
            );
            
            // Test 6: Check LotteryAlgorithms
            addTestResult(
                'LotteryAlgorithms Class',
                window.LotteryAlgorithms && typeof window.LotteryAlgorithms === 'function',
                window.LotteryAlgorithms ? 'Available' : 'Not available'
            );
            
            // Test 7: Check algorithm methods
            if (window.lotteryService && window.lotteryService.algorithms) {
                const algorithms = window.lotteryService.algorithms;
                addTestResult(
                    'Algorithm Methods',
                    typeof algorithms.random === 'function' && 
                    typeof algorithms.frequency === 'function' &&
                    typeof algorithms.hybrid === 'function',
                    `random: ${typeof algorithms.random}, frequency: ${typeof algorithms.frequency}, hybrid: ${typeof algorithms.hybrid}`
                );
            }
        }
        
        async function testNumberGeneration(algorithm) {
            try {
                console.log(`Testing ${algorithm} generation...`);
                const result = await window.lotteryService.generateNumbers(algorithm, 3);
                
                addTestResult(
                    `${algorithm} Generation`,
                    result.success && result.data && Array.isArray(result.data),
                    result.success ? 
                        `Generated ${result.data.length} sets: ${JSON.stringify(result.data[0]?.numbers)} + ${result.data[0]?.powerball}` :
                        `Error: ${result.error}`
                );
            } catch (error) {
                addTestResult(
                    `${algorithm} Generation`,
                    false,
                    `Exception: ${error.message}`
                );
            }
        }
        
        // Run tests when page loads
        window.addEventListener('load', () => {
            setTimeout(runBasicTests, 1000); // Give time for services to initialize
        });
    </script>
</body>
</html>