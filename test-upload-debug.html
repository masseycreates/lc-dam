<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Debug Test</title>
</head>
<body>
    <h1>Upload Debug Test</h1>
    <button onclick="testUpload()">Test Upload with Simple Data</button>
    <div id="results"></div>

    <script>
        async function testUpload() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = 'Testing upload...';

            // Simple test data
            const testData = [
                {
                    "id": "test_001",
                    "numbers": [1, 2, 3, 4, 5],
                    "powerball": 1,
                    "name": "Test Selection",
                    "source": "Manual",
                    "confidence": 50,
                    "strategy": "Test"
                }
            ];

            try {
                // Create form data
                const formData = new FormData();
                const blob = new Blob([JSON.stringify(testData, null, 2)], { type: 'application/json' });
                formData.append('historyFile', blob, 'test-data.json');

                // Upload
                const response = await fetch('/api/upload-history', {
                    method: 'POST',
                    headers: {
                        'X-User-ID': 'test_user_123'
                    },
                    body: formData
                });

                const result = await response.json();
                console.log('Upload result:', result);

                // Display results
                resultsDiv.innerHTML = `
                    <h3>Upload Result:</h3>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;

                // Now test retrieval
                const getResponse = await fetch('/api/selection-history', {
                    headers: {
                        'X-User-ID': 'test_user_123'
                    }
                });

                const getData = await getResponse.json();
                console.log('Get data result:', getData);

                resultsDiv.innerHTML += `
                    <h3>Retrieved Data:</h3>
                    <pre>${JSON.stringify(getData, null, 2)}</pre>
                `;

            } catch (error) {
                console.error('Test error:', error);
                resultsDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>