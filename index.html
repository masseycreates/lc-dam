<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé∞ Claude AI + 6 Algorithms Lottery System</title>
    
    <!-- External Libraries -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üé∞</text></svg>">
    
    <!-- Load CSS -->
    <link rel="stylesheet" href="public_tools/css/styles.css">
</head>
<body>
    <div id="root">
        <div style="text-align: center; padding: 2rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; min-height: 100vh;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üé∞</div>
            <div style="font-size: 1.5rem; margin-bottom: 1rem;">Loading Claude AI + 6 Algorithms...</div>
            <div id="loading-progress" style="font-size: 0.9rem; opacity: 0.8;">Initializing...</div>
        </div>
    </div>

    <!-- Load JavaScript files in correct order -->
    <!-- 1. Constants and utilities first -->
    <script src="public_tools/js/utils/constants.js"></script>
    <script src="public_tools/js/utils/helpers.js"></script>
    
    <!-- 2. Services -->
    <script src="public_tools/js/services/ApiService.js"></script>
    <script src="public_tools/js/services/LotteryPredictor.js"></script>
    <script src="public_tools/js/services/ClaudeAnalyzer.js"></script>
    <script src="public_tools/js/services/TaxCalculatorService.js"></script>
    
    <!-- 3. Components -->
    <script src="public_tools/js/components/Header.js"></script>
    <script src="public_tools/js/components/QuickSelection.js"></script>
    <script src="public_tools/js/components/ManualCalculator.js"></script>
    <script src="public_tools/js/components/TaxCalculator.js"></script>
    <script src="public_tools/js/components/DataAnalysis.js"></script>
    
    <!-- 4. Main app last -->
    <script type="text/babel">
        // Simple Error Boundary
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }

            static getDerivedStateFromError(error) {
                return { hasError: true, error: error };
            }

            componentDidCatch(error, errorInfo) {
                console.error('App Error:', error, errorInfo);
            }

            render() {
                if (this.state.hasError) {
                    return React.createElement('div', { 
                        className: 'min-h-screen flex items-center justify-center bg-gray-50' 
                    },
                        React.createElement('div', { className: 'text-center p-8' },
                            React.createElement('div', { className: 'text-6xl mb-4' }, '‚ö†Ô∏è'),
                            React.createElement('h1', { className: 'text-2xl font-bold text-gray-900 mb-4' }, 'Application Error'),
                            React.createElement('p', { className: 'text-gray-600 mb-6' }, 'Something went wrong. Please reload the page.'),
                            React.createElement('button', {
                                onClick: () => window.location.reload(),
                                className: 'px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600'
                            }, 'Reload Application'),
                            React.createElement('p', { className: 'text-xs text-gray-500 mt-4' },
                                this.state.error ? this.state.error.message : 'Unknown error'
                            )
                        )
                    );
                }

                return this.props.children;
            }
        }

        // Main Application Component
        function LotteryApp() {
            const { useState, useEffect } = React;
            
            const [isLoading, setIsLoading] = useState(true);
            const [currentJackpot, setCurrentJackpot] = useState(null);
            const [selectedNumbers, setSelectedNumbers] = useState([]);
            const [powerball, setPowerball] = useState('');
            const [activeTab, setActiveTab] = useState('generator');
            const [apiStatus, setApiStatus] = useState('Testing...');
            const [aiApiKey, setAiApiKey] = useState('');
            const [aiEnabled, setAiEnabled] = useState(false);
            const [loadingStep, setLoadingStep] = useState('Initializing...');
            const [nextDrawDate, setNextDrawDate] = useState('');
            const [lastUpdated, setLastUpdated] = useState('');
            const [isUpdating, setIsUpdating] = useState(false);

            useEffect(() => {
                const maxLoadingTime = setTimeout(() => {
                    console.log('‚è∞ Maximum loading time reached, forcing app load');
                    setApiStatus('‚ö†Ô∏è API Timeout');
                    setIsLoading(false);
                }, 10000);

                const initializeApp = async () => {
                    try {
                        setLoadingStep('Testing API connection...');
                        await testApiConnection();
                        
                        setLoadingStep('Loading jackpot data...');
                        await loadJackpotData();
                        
                        setLoadingStep('System ready!');
                        clearTimeout(maxLoadingTime);
                        setIsLoading(false);
                    } catch (error) {
                        console.warn('Initialization error:', error);
                        setApiStatus('‚ö†Ô∏è Limited Mode');
                        clearTimeout(maxLoadingTime);
                        setIsLoading(false);
                    }
                };

                initializeApp();
                return () => clearTimeout(maxLoadingTime);
            }, []);

            const testApiConnection = async () => {
                try {
                    const response = await fetch('/api/test', { 
                        method: 'GET',
                        signal: AbortSignal.timeout(5000)
                    });
                    const data = await response.json();
                    
                    if (data.success) {
                        setApiStatus('‚úÖ API Connected');
                        return true;
                    } else {
                        setApiStatus('‚ö†Ô∏è API Issues');
                        return false;
                    }
                } catch (error) {
                    console.warn('API test failed:', error);
                    setApiStatus('‚ö†Ô∏è API Offline');
                    return false;
                }
            };

            const loadJackpotData = async () => {
                try {
                    const response = await fetch('/api/powerball', {
                        method: 'GET',
                        signal: AbortSignal.timeout(8000)
                    });
                    const data = await response.json();
                    
                    if (data.success && data.jackpot) {
                        setCurrentJackpot(data.jackpot);
                        if (data.nextDrawing) {
                            setNextDrawDate(`${data.nextDrawing.date} @ ${data.nextDrawing.time}`);
                        }
                        setLastUpdated(new Date().toLocaleString());
                        return true;
                    }
                } catch (error) {
                    console.warn('Jackpot data failed:', error);
                }
                return false;
            };

            const refreshData = async () => {
                setIsUpdating(true);
                await loadJackpotData();
                setIsUpdating(false);
            };

            const generateQuickPick = () => {
                const numbers = [];
                while (numbers.length < 5) {
                    const num = Math.floor(Math.random() * 69) + 1;
                    if (!numbers.includes(num)) numbers.push(num);
                }
                setSelectedNumbers(numbers.sort((a, b) => a - b));
                setPowerball(Math.floor(Math.random() * 26) + 1);
            };

            const testClaudeAPI = async () => {
                if (!aiApiKey.trim() || !aiApiKey.startsWith('sk-ant-')) {
                    alert('Please enter a valid Anthropic API key (starts with sk-ant-)');
                    return;
                }

                try {
                    const response = await fetch('/api/claude', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            apiKey: aiApiKey,
                            analysisType: 'predictionInsights'
                        }),
                        signal: AbortSignal.timeout(10000)
                    });

                    const data = await response.json();
                    
                    if (data.success) {
                        setAiEnabled(true);
                        alert('‚úÖ Claude AI connected successfully!');
                    } else {
                        alert('‚ùå Claude AI connection failed: ' + data.error);
                    }
                } catch (error) {
                    alert('‚ùå Claude AI error: ' + error.message);
                }
            };

            const generateAdvancedNumbers = async () => {
                if (!aiEnabled) {
                    generateQuickPick();
                    return;
                }

                try {
                    const response = await fetch('/api/claude', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            apiKey: aiApiKey,
                            analysisType: 'hybridSelection',
                            requestedSets: 1
                        }),
                        signal: AbortSignal.timeout(12000)
                    });

                    const data = await response.json();
                    
                    if (data.success && data.claudeSelections && data.claudeSelections.length > 0) {
                        const selection = data.claudeSelections[0];
                        setSelectedNumbers(selection.numbers);
                        setPowerball(selection.powerball);
                    } else {
                        generateQuickPick();
                    }
                } catch (error) {
                    console.warn('Claude generation failed:', error);
                    generateQuickPick();
                }
            };

            // Update loading progress
            useEffect(() => {
                const progressElement = document.getElementById('loading-progress');
                if (progressElement && isLoading) {
                    progressElement.textContent = loadingStep;
                }
            }, [loadingStep, isLoading]);

            if (isLoading) {
                return React.createElement('div', { 
                    className: 'min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-600 to-blue-600 text-white' 
                },
                    React.createElement('div', { className: 'text-center' },
                        React.createElement('div', { className: 'text-6xl mb-4 animate-bounce' }, 'üé∞'),
                        React.createElement('div', { className: 'text-2xl font-bold mb-2' }, 'Claude AI + 6 Algorithms'),
                        React.createElement('div', { className: 'text-lg opacity-80' }, 'Advanced Lottery Intelligence System'),
                        React.createElement('div', { className: 'mt-4 text-sm opacity-60' }, loadingStep),
                        React.createElement('div', { className: 'mt-2 text-xs opacity-40' },
                            'Loading will complete automatically in a few seconds...'
                        )
                    )
                );
            }

            return React.createElement('div', { className: 'min-h-screen bg-gray-50' },
                // Header
                React.createElement('div', { 
                    className: currentJackpot ? 
                        'bg-gradient-to-r from-purple-600 to-blue-600 text-white p-4' :
                        'bg-gradient-to-r from-gray-600 to-gray-700 text-white p-4'
                },
                    React.createElement('div', { className: 'max-w-4xl mx-auto' },
                        React.createElement('div', { className: 'flex items-center justify-between' },
                            React.createElement('div', { className: 'flex items-center gap-3' },
                                React.createElement('div', { className: 'text-3xl' }, 'üé∞'),
                                React.createElement('div', null,
                                    React.createElement('h1', { className: 'text-xl font-bold' },
                                        aiEnabled ? 'Claude AI + 6 Algorithms Hybrid' : 'Enhanced Lottery System'
                                    ),
                                    React.createElement('p', { className: 'text-sm opacity-80' },
                                        currentJackpot ? currentJackpot.formatted : 'Visit powerball.com for current jackpot'
                                    )
                                )
                            ),
                            React.createElement('div', { className: 'text-right' },
                                React.createElement('button', {
                                    onClick: refreshData,
                                    disabled: isUpdating,
                                    className: 'bg-white bg-opacity-20 hover:bg-opacity-30 px-3 py-1 rounded text-sm transition-colors'
                                }, isUpdating ? '‚è≥ Loading...' : 'üîÑ Refresh'),
                                React.createElement('div', { className: 'text-xs opacity-70 mt-1' }, apiStatus)
                            )
                        )
                    )
                ),

                React.createElement('div', { className: 'max-w-4xl mx-auto p-4' },
                    // Tab Navigation
                    React.createElement('div', { className: 'mb-6' },
                        React.createElement('div', { className: 'flex border-b border-gray-200' },
                            [
                                { id: 'generator', label: 'Number Generator', icon: 'üé≤' },
                                { id: 'ai-setup', label: 'Claude AI Setup', icon: 'ü§ñ' },
                                { id: 'tools', label: 'Tools', icon: 'üîß' }
                            ].map(tab =>
                                React.createElement('button', {
                                    key: tab.id,
                                    onClick: () => setActiveTab(tab.id),
                                    className: `px-4 py-2 font-medium border-b-2 transition-colors ${
                                        activeTab === tab.id 
                                            ? 'border-blue-500 text-blue-600' 
                                            : 'border-transparent text-gray-500 hover:text-gray-700'
                                    }`
                                }, tab.icon, ' ', tab.label)
                            )
                        )
                    ),

                    // Tab Content
                    activeTab === 'generator' && React.createElement('div', { className: 'space-y-6' },
                        React.createElement('div', { className: 'bg-white rounded-lg border-2 border-gray-200 p-6' },
                            React.createElement('h2', { className: 'text-xl font-bold mb-4' },
                                aiEnabled ? 'ü§ñüßÆ Hybrid AI Generator' : 'üé≤ Quick Pick Generator'
                            ),
                            
                            selectedNumbers.length > 0 && React.createElement('div', { className: 'mb-4 p-4 bg-blue-50 rounded-lg' },
                                React.createElement('h3', { className: 'font-semibold mb-2' }, 'Your Numbers:'),
                                React.createElement('div', { className: 'flex items-center gap-2' },
                                    React.createElement('div', { className: 'flex gap-1' },
                                        selectedNumbers.map(num =>
                                            React.createElement('span', { 
                                                key: num, 
                                                className: 'bg-gray-200 px-3 py-1 rounded font-mono'
                                            }, num)
                                        )
                                    ),
                                    React.createElement('span', { 
                                        className: 'bg-red-500 text-white px-3 py-1 rounded font-mono' 
                                    }, `PB: ${powerball}`)
                                )
                            ),

                            React.createElement('div', { className: 'flex gap-3 flex-wrap' },
                                React.createElement('button', {
                                    onClick: aiEnabled ? generateAdvancedNumbers : generateQuickPick,
                                    className: 'px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors'
                                }, aiEnabled ? 'ü§ñüßÆ Generate Hybrid' : 'üé≤ Generate Quick Pick'),
                                
                                React.createElement('button', {
                                    onClick: generateQuickPick,
                                    className: 'px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors'
                                }, 'üé≤ Random Quick Pick'),
                                
                                selectedNumbers.length > 0 && React.createElement('button', {
                                    onClick: () => {
                                        const ticket = `${selectedNumbers.join(', ')} | PB: ${powerball}`;
                                        if (navigator.clipboard) {
                                            navigator.clipboard.writeText(ticket);
                                        } else {
                                            alert(`Numbers: ${ticket}`);
                                        }
                                    },
                                    className: 'px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors'
                                }, 'üìã Copy Numbers')
                            )
                        )
                    ),

                    activeTab === 'ai-setup' && React.createElement('div', { className: 'space-y-6' },
                        React.createElement('div', { className: 'bg-white rounded-lg border-2 border-gray-200 p-6' },
                            React.createElement('h2', { className: 'text-xl font-bold mb-4' }, 'ü§ñ Claude AI Setup'),
                            
                            !aiEnabled ? React.createElement('div', null,
                                React.createElement('p', { className: 'text-gray-600 mb-4' },
                                    'Enable hybrid Claude AI + 6 Algorithms analysis for enhanced predictions.'
                                ),
                                
                                React.createElement('div', { className: 'space-y-4' },
                                    React.createElement('div', null,
                                        React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-2' },
                                            'Anthropic API Key'
                                        ),
                                        React.createElement('input', {
                                            type: 'password',
                                            value: aiApiKey,
                                            onChange: (e) => setAiApiKey(e.target.value),
                                            placeholder: 'sk-ant-...',
                                            className: 'w-full px-3 py-2 border border-gray-300 rounded-lg'
                                        })
                                    ),
                                    
                                    React.createElement('button', {
                                        onClick: testClaudeAPI,
                                        disabled: !aiApiKey.trim(),
                                        className: aiApiKey.trim() ?
                                            'bg-purple-600 text-white hover:bg-purple-700 px-6 py-3 rounded-lg transition-colors' :
                                            'bg-gray-300 text-gray-600 cursor-not-allowed px-6 py-3 rounded-lg'
                                    }, 'üöÄ Test & Enable Claude AI')
                                ),
                                
                                React.createElement('p', { className: 'text-xs text-gray-500 mt-4' },
                                    'Get your API key from ',
                                    React.createElement('a', { 
                                        href: 'https://console.anthropic.com/', 
                                        target: '_blank',
                                        className: 'text-blue-600 hover:underline'
                                    }, 'console.anthropic.com'),
                                    '. Your key is stored locally and never shared.'
                                )
                            ) : React.createElement('div', { className: 'bg-green-50 border border-green-200 rounded-lg p-4' },
                                React.createElement('div', { className: 'flex items-center gap-2' },
                                    React.createElement('span', { className: 'text-2xl' }, '‚úÖ'),
                                    React.createElement('div', null,
                                        React.createElement('h3', { className: 'font-semibold text-green-800' }, 'Claude AI Active'),
                                        React.createElement('p', { className: 'text-green-700 text-sm' },
                                            'Hybrid analysis is now available. Advanced algorithms are enhanced with Claude AI insights.'
                                        )
                                    )
                                )
                            )
                        )
                    ),

                    activeTab === 'tools' && React.createElement('div', { className: 'space-y-6' },
                        React.createElement('div', { className: 'bg-white rounded-lg border-2 border-gray-200 p-6' },
                            React.createElement('h2', { className: 'text-xl font-bold mb-4' }, 'üîß System Tools & Diagnostics'),
                            
                            React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                                React.createElement('button', {
                                    onClick: () => window.open('/api/test', '_blank'),
                                    className: 'p-4 text-left border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors'
                                },
                                    React.createElement('div', { className: 'text-lg font-semibold' }, 'üîç API Test'),
                                    React.createElement('div', { className: 'text-sm text-gray-600' }, 'Test API connectivity')
                                ),
                                
                                React.createElement('button', {
                                    onClick: () => window.open('/api/powerball', '_blank'),
                                    className: 'p-4 text-left border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors'
                                },
                                    React.createElement('div', { className: 'text-lg font-semibold' }, 'üé∞ Powerball API'),
                                    React.createElement('div', { className: 'text-sm text-gray-600' }, 'Check live jackpot data')
                                ),
                                
                                React.createElement('button', {
                                    onClick: () => window.location.reload(),
                                    className: 'p-4 text-left border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors'
                                },
                                    React.createElement('div', { className: 'text-lg font-semibold' }, 'üîÑ Reload App'),
                                    React.createElement('div', { className: 'text-sm text-gray-600' }, 'Refresh application')
                                )
                            ),

                            React.createElement('div', { className: 'mt-6 p-4 bg-gray-50 rounded-lg' },
                                React.createElement('h3', { className: 'font-semibold mb-2' }, 'üìä Current Status'),
                                React.createElement('div', { className: 'text-sm space-y-1' },
                                    React.createElement('div', null, `API Status: ${apiStatus}`),
                                    React.createElement('div', null, `Jackpot Data: ${currentJackpot ? '‚úÖ Available' : '‚ùå Unavailable'}`),
                                    React.createElement('div', null, `Claude AI: ${aiEnabled ? 'ü§ñ Active' : '‚≠ï Disabled'}`),
                                    React.createElement('div', null, `Last Load: ${new Date().toLocaleTimeString()}`)
                                )
                            )
                        )
                    ),

                    // Footer
                    React.createElement('div', { className: 'mt-8 text-center text-xs text-gray-500' },
                        React.createElement('p', null, 'üé∞ Claude AI + 6 Algorithms Hybrid Lottery System ‚Ä¢ Educational purposes only'),
                        React.createElement('p', { className: 'mt-1' },
                            `Data: ${apiStatus} ‚Ä¢ AI: ${aiEnabled ? 'ü§ñ Hybrid Active' : 'Local Only'}`
                        )
                    )
                )
            );
        }

        // Initialize Application
        function App() {
            return React.createElement(ErrorBoundary, null,
                React.createElement(LotteryApp)
            );
        }

        // Render the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ Lottery System Loading...');
            try {
                const root = ReactDOM.createRoot(document.getElementById('root'));
                root.render(React.createElement(App));
                console.log('‚úÖ Lottery System Loaded Successfully');
            } catch (error) {
                console.error('‚ùå Failed to render application:', error);
                document.getElementById('root').innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: red;">
                        <h1>Application Failed to Load</h1>
                        <p>Error: ${error.message}</p>
                        <button onclick="window.location.reload()" 
                                style="padding: 0.5rem 1rem; margin-top: 1rem;">
                            Reload Page
                        </button>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
