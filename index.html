<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Lottery Intelligence System</title>
    
    <!-- React Libraries -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üé∞</text></svg>">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #ffffff;
            color: #1f2937;
            line-height: 1.6;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #9333ea 0%, #3b82f6 50%, #10b981 100%);
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2563eb;
        }
        
        .btn-secondary {
            background-color: #6b7280;
            color: white;
        }
        
        .btn-purple {
            background-color: #9333ea;
            color: white;
        }
        
        .btn-purple:hover {
            background-color: #7c3aed;
        }
        
        .grid {
            display: grid;
            gap: 1rem;
        }
        
        .grid-cols-2 {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .grid-cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .grid-cols-10 {
            grid-template-columns: repeat(10, 1fr);
        }
        
        .flex {
            display: flex;
        }
        
        .items-center {
            align-items: center;
        }
        
        .justify-between {
            justify-content: space-between;
        }
        
        .gap-2 {
            gap: 0.5rem;
        }
        
        .gap-4 {
            gap: 1rem;
        }
        
        .text-center {
            text-align: center;
        }
        
        .text-white {
            color: white;
        }
        
        .text-2xl {
            font-size: 1.5rem;
        }
        
        .text-3xl {
            font-size: 1.875rem;
        }
        
        .text-4xl {
            font-size: 2.25rem;
        }
        
        .font-bold {
            font-weight: 700;
        }
        
        .font-semibold {
            font-weight: 600;
        }
        
        .mb-2 {
            margin-bottom: 0.5rem;
        }
        
        .mb-4 {
            margin-bottom: 1rem;
        }
        
        .mb-6 {
            margin-bottom: 1.5rem;
        }
        
        .mb-8 {
            margin-bottom: 2rem;
        }
        
        .p-4 {
            padding: 1rem;
        }
        
        .p-6 {
            padding: 1.5rem;
        }
        
        .px-3 {
            padding-left: 0.75rem;
            padding-right: 0.75rem;
        }
        
        .py-2 {
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
        }
        
        .rounded {
            border-radius: 0.25rem;
        }
        
        .rounded-lg {
            border-radius: 0.5rem;
        }
        
        .rounded-xl {
            border-radius: 0.75rem;
        }
        
        .border {
            border: 1px solid #d1d5db;
        }
        
        .bg-white {
            background-color: white;
        }
        
        .bg-gray-50 {
            background-color: #f9fafb;
        }
        
        .bg-gray-100 {
            background-color: #f3f4f6;
        }
        
        .bg-blue-50 {
            background-color: #eff6ff;
        }
        
        .bg-green-50 {
            background-color: #f0fdf4;
        }
        
        .bg-purple-600 {
            background-color: #9333ea;
        }
        
        .text-purple-600 {
            color: #9333ea;
        }
        
        .text-green-600 {
            color: #059669;
        }
        
        .text-blue-600 {
            color: #2563eb;
        }
        
        .text-gray-600 {
            color: #4b5563;
        }
        
        .text-gray-800 {
            color: #1f2937;
        }
        
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 1.5rem;
        }
        
        .tab {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            background: white;
            color: #4b5563;
            transition: all 0.2s;
        }
        
        .tab.active {
            background: #9333ea;
            color: white;
        }
        
        .tab:hover {
            background: #f3f4f6;
        }
        
        .tab.active:hover {
            background: #7c3aed;
        }
        
        .number-btn {
            width: 2rem;
            height: 2rem;
            font-size: 0.75rem;
            border-radius: 4px;
            border: 1px solid #d1d5db;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .number-btn:hover {
            background: #f3f4f6;
        }
        
        .number-btn.selected {
            background: #9333ea;
            color: white;
            border-color: #9333ea;
        }
        
        .number-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .sticky-top {
            position: sticky;
            top: 0;
            z-index: 50;
        }
        
        .backdrop-blur {
            backdrop-filter: blur(4px);
        }
        
        .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        input, select {
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.25rem;
            font-size: 0.875rem;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .loading-spinner {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        
        .status-success {
            background-color: #f0fdf4;
            color: #059669;
            border: 1px solid #bbf7d0;
        }
        
        .status-error {
            background-color: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        
        .status-warning {
            background-color: #fefce8;
            color: #d97706;
            border: 1px solid #fde68a;
        }
        
        /* Quick Selection specific styles */
        .quick-selection-card {
            background: linear-gradient(135deg, #f0f4ff 0%, #e0f2fe 100%);
            border: 2px solid #3b82f6;
        }
        
        .strategy-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
        }
        
        .number-display {
            background-color: #f3f4f6;
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            font-family: monospace;
            font-size: 0.875rem;
            font-weight: 600;
            border: 1px solid #d1d5db;
        }
        
        .powerball-display {
            background-color: #ef4444;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            font-family: monospace;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            .grid-cols-2 {
                grid-template-columns: 1fr;
            }
            
            .grid-cols-3 {
                grid-template-columns: 1fr;
            }
            
            .grid-cols-10 {
                grid-template-columns: repeat(5, 1fr);
            }
            
            .text-4xl {
                font-size: 1.875rem;
            }
            
            .text-3xl {
                font-size: 1.5rem;
            }
            
            .container {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div id="root">
        <div style="text-align: center; padding: 2rem;">
            <div style="font-size: 2rem; margin-bottom: 1rem;">üé∞</div>
            <div>Loading Advanced Lottery System...</div>
            <div style="margin-top: 1rem; font-size: 0.875rem; color: #6b7280;">
                If this doesn't load, check the browser console for errors (F12)
            </div>
        </div>
    </div>
    
    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        const AdvancedLotteryAnalysisSystem = () => {
            const [selectedNumbers, setSelectedNumbers] = useState([]);
            const [powerball, setPowerball] = useState('');
            const [activeTab, setActiveTab] = useState('calculator');
            const [jackpotAmount, setJackpotAmount] = useState(100);
            const [selectedState, setSelectedState] = useState('FL');
            const [filingStatus, setFilingStatus] = useState('single');
            const [numTickets, setNumTickets] = useState(1);
            const [monteCarloRuns, setMonteCarloRuns] = useState(1000);
            const [currentJackpot, setCurrentJackpot] = useState(null);
            const [nextDrawDate, setNextDrawDate] = useState('');
            const [lastUpdated, setLastUpdated] = useState(new Date().toISOString().split('T')[0]);
            const [isUpdating, setIsUpdating] = useState(false);
            const [updateStatus, setUpdateStatus] = useState('');
            const [apiHealthy, setApiHealthy] = useState(false);
            
            // Optimization states
            const [optimizationStrategy, setOptimizationStrategy] = useState('balanced');
            const [numOptimizedSets, setNumOptimizedSets] = useState(3);
            const [optimizedSets, setOptimizedSets] = useState([]);
            const [isOptimizing, setIsOptimizing] = useState(false);
            
            // Monte Carlo states
            const [ticketsPerDraw, setTicketsPerDraw] = useState(10);
            const [yearsToSimulate, setYearsToSimulate] = useState(10);
            const [simulationResults, setSimulationResults] = useState(null);
            const [isSimulating, setIsSimulating] = useState(false);
            const [simulationProgress, setSimulationProgress] = useState(0);

            // State tax information - All Powerball participating states/jurisdictions
            const stateTaxInfo = {
                'AL': { name: 'Alabama', rate: 5.0, withholding: 5.0 },
                'AZ': { name: 'Arizona', rate: 4.5, withholding: 5.0 },
                'AR': { name: 'Arkansas', rate: 5.5, withholding: 7.0 },
                'CA': { name: 'California', rate: 13.3, withholding: 7.25 },
                'CO': { name: 'Colorado', rate: 4.4, withholding: 4.63 },
                'CT': { name: 'Connecticut', rate: 6.99, withholding: 6.99 },
                'DE': { name: 'Delaware', rate: 6.6, withholding: 6.6 },
                'DC': { name: 'Washington D.C.', rate: 10.75, withholding: 8.5 },
                'FL': { name: 'Florida', rate: 0, withholding: 0 },
                'GA': { name: 'Georgia', rate: 5.75, withholding: 6.0 },
                'ID': { name: 'Idaho', rate: 6.0, withholding: 6.0 },
                'IL': { name: 'Illinois', rate: 4.95, withholding: 4.95 },
                'IN': { name: 'Indiana', rate: 3.23, withholding: 3.4 },
                'IA': { name: 'Iowa', rate: 8.53, withholding: 5.0 },
                'KS': { name: 'Kansas', rate: 5.7, withholding: 5.0 },
                'KY': { name: 'Kentucky', rate: 6.0, withholding: 6.0 },
                'LA': { name: 'Louisiana', rate: 4.75, withholding: 4.75 },
                'ME': { name: 'Maine', rate: 7.15, withholding: 5.0 },
                'MD': { name: 'Maryland', rate: 8.75, withholding: 8.95 },
                'MA': { name: 'Massachusetts', rate: 5.0, withholding: 5.0 },
                'MI': { name: 'Michigan', rate: 4.25, withholding: 4.25 },
                'MN': { name: 'Minnesota', rate: 9.85, withholding: 7.25 },
                'MS': { name: 'Mississippi', rate: 5.0, withholding: 5.0 },
                'MO': { name: 'Missouri', rate: 4.0, withholding: 4.0 },
                'MT': { name: 'Montana', rate: 6.75, withholding: 6.75 },
                'NE': { name: 'Nebraska', rate: 5.84, withholding: 5.0 },
                'NH': { name: 'New Hampshire', rate: 0, withholding: 0 },
                'NJ': { name: 'New Jersey', rate: 10.75, withholding: 5.0 },
                'NM': { name: 'New Mexico', rate: 5.9, withholding: 6.0 },
                'NY': { name: 'New York', rate: 10.9, withholding: 10.9, local: 3.876 },
                'NC': { name: 'North Carolina', rate: 4.99, withholding: 5.25 },
                'ND': { name: 'North Dakota', rate: 2.9, withholding: 2.9 },
                'OH': { name: 'Ohio', rate: 3.99, withholding: 4.0 },
                'OK': { name: 'Oklahoma', rate: 6.0, withholding: 5.0 },
                'OR': { name: 'Oregon', rate: 9.9, withholding: 8.0 },
                'PA': { name: 'Pennsylvania', rate: 3.07, withholding: 3.07 },
                'PR': { name: 'Puerto Rico', rate: 20.0, withholding: 20.0 },
                'RI': { name: 'Rhode Island', rate: 5.99, withholding: 5.99 },
                'SC': { name: 'South Carolina', rate: 7.0, withholding: 7.0 },
                'SD': { name: 'South Dakota', rate: 0, withholding: 0 },
                'TN': { name: 'Tennessee', rate: 0, withholding: 0 },
                'TX': { name: 'Texas', rate: 0, withholding: 0 },
                'VI': { name: 'U.S. Virgin Islands', rate: 0, withholding: 0 },
                'VT': { name: 'Vermont', rate: 6.0, withholding: 6.0 },
                'VA': { name: 'Virginia', rate: 5.75, withholding: 4.0 },
                'WA': { name: 'Washington', rate: 0, withholding: 0 },
                'WV': { name: 'West Virginia', rate: 6.5, withholding: 6.5 },
                'WI': { name: 'Wisconsin', rate: 7.65, withholding: 7.65 },
                'WY': { name: 'Wyoming', rate: 0, withholding: 0 }
            };

            // Fallback jackpot data
            const getFallbackJackpotData = () => {
                return {
                    amount: 735000000,
                    cashValue: 441000000,
                    formatted: "$735M",
                    cashFormatted: "$441M",
                    source: "Estimated (API Unavailable)"
                };
            };

            // Calculate next drawing date
            const calculateNextDrawing = () => {
                const now = new Date();
                const et = new Date(now.toLocaleString("en-US", {timeZone: "America/New_York"}));
                
                const dayOfWeek = et.getDay();
                const hour = et.getHours();
                
                let daysToAdd = 0;
                
                // Drawing days: Monday (1), Wednesday (3), Saturday (6)
                if (dayOfWeek === 0) { // Sunday
                    daysToAdd = 1; // Next Monday
                } else if (dayOfWeek === 1) { // Monday
                    daysToAdd = (hour >= 23) ? 2 : 0; // Wed if after drawing, today if before
                } else if (dayOfWeek === 2) { // Tuesday
                    daysToAdd = 1; // Next Wednesday
                } else if (dayOfWeek === 3) { // Wednesday
                    daysToAdd = (hour >= 23) ? 3 : 0; // Sat if after drawing, today if before
                } else if (dayOfWeek === 4 || dayOfWeek === 5) { // Thu/Fri
                    daysToAdd = 6 - dayOfWeek; // Next Saturday
                } else if (dayOfWeek === 6) { // Saturday
                    daysToAdd = (hour >= 23) ? 2 : 0; // Mon if after drawing, today if before
                }
                
                const nextDraw = new Date(et);
                nextDraw.setDate(et.getDate() + daysToAdd);
                
                return {
                    date: nextDraw.toLocaleDateString('en-US', { 
                        weekday: 'short', 
                        month: 'short', 
                        day: 'numeric',
                        timeZone: 'America/New_York'
                    }),
                    time: '10:59 PM ET'
                };
            };

            // Enhanced API implementation with better error handling
            const fetchLatestPowerballData = async () => {
                setIsUpdating(true);
                setUpdateStatus('üîÑ Fetching live jackpot data...');
                
                try {
                    console.log('Attempting to fetch from /api/powerball...');
                    setUpdateStatus('üåê Connecting to lottery data API...');
                    
                    // Try the API with proper error handling
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout
                    
                    const response = await fetch('/api/powerball', {
                        method: 'GET',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Cache-Control': 'no-cache'
                        },
                        signal: controller.signal
                    });
                    
                    clearTimeout(timeoutId);
                    
                    if (!response.ok) {
                        throw new Error(`API returned ${response.status}: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    console.log('API Response:', data);
                    
                    if (!data.success || !data.jackpot) {
                        throw new Error(data.message || 'Invalid API response format');
                    }
                    
                    // Success - use real data
                    setCurrentJackpot({
                        amount: data.jackpot.amount,
                        cashValue: data.jackpot.cashValue,
                        formatted: data.jackpot.formatted,
                        cashFormatted: data.jackpot.cashFormatted,
                        source: data.source || 'Official API'
                    });
                    
                    if (data.nextDrawing) {
                        setNextDrawDate(`${data.nextDrawing.date} @ ${data.nextDrawing.time}`);
                    } else {
                        const nextDraw = calculateNextDrawing();
                        setNextDrawDate(`${nextDraw.date} @ ${nextDraw.time}`);
                    }
                    
                    setUpdateStatus(`‚úÖ Live data from ${data.source}: ${data.jackpot.formatted}`);
                    setApiHealthy(true);
                    
                } catch (error) {
                    console.error('API Error:', error);
                    
                    // Fallback to estimated data
                    const fallbackData = getFallbackJackpotData();
                    setCurrentJackpot(fallbackData);
                    
                    const nextDraw = calculateNextDrawing();
                    setNextDrawDate(`${nextDraw.date} @ ${nextDraw.time}`);
                    
                    setApiHealthy(false);
                    
                    if (error.name === 'AbortError') {
                        setUpdateStatus('‚ö†Ô∏è API timeout - using estimated jackpot data');
                    } else if (error.message.includes('404')) {
                        setUpdateStatus('‚ö†Ô∏è API endpoint not found - using estimated data');
                    } else if (error.message.includes('Failed to fetch')) {
                        setUpdateStatus('‚ö†Ô∏è Network error - using estimated jackpot data');
                    } else {
                        setUpdateStatus(`‚ö†Ô∏è API error: ${error.message} - using estimated data`);
                    }
                }
                
                setLastUpdated(new Date().toISOString().split('T')[0]);
                setIsUpdating(false);
            };

            // Initialize data on component mount
            useEffect(() => {
                console.log('Component mounted, initializing...');
                const initializeData = async () => {
                    setUpdateStatus('üöÄ Initializing lottery system...');
                    await fetchLatestPowerballData();
                };
                initializeData();
            }, []);

            const toggleNumber = (num) => {
                if (selectedNumbers.includes(num)) {
                    setSelectedNumbers(selectedNumbers.filter(n => n !== num));
                } else if (selectedNumbers.length < 5) {
                    setSelectedNumbers([...selectedNumbers, num].sort((a, b) => a - b));
                }
            };

            const clearSelection = () => {
                setSelectedNumbers([]);
                setPowerball('');
            };

            const quickPick = () => {
                // Generate 5 random numbers from 1-69
                const numbers = [];
                while (numbers.length < 5) {
                    const num = Math.floor(Math.random() * 69) + 1;
                    if (!numbers.includes(num)) {
                        numbers.push(num);
                    }
                }
                setSelectedNumbers(numbers.sort((a, b) => a - b));
                
                // Generate random powerball 1-26
                setPowerball(Math.floor(Math.random() * 26) + 1);
            };

            const calculateExpectedValue = () => {
                if (!currentJackpot) return 0;
                const jackpotProb = 1 / 292201338;
                const otherPrizes = 0.32; // Expected value from other prize tiers
                const ticketCost = 2;
                return (currentJackpot.amount * jackpotProb + otherPrizes) - ticketCost;
            };

            // Number optimization algorithms
            const generateOptimizedNumbers = async () => {
                setIsOptimizing(true);
                setOptimizedSets([]);
                
                await new Promise(resolve => setTimeout(resolve, 500)); // Simulate processing
                
                const newSets = [];
                
                for (let i = 0; i < numOptimizedSets; i++) {
                    let numbers = [];
                    let powerball = 0;
                    let strategy = optimizationStrategy;
                    let score = 0;
                    
                    switch (optimizationStrategy) {
                        case 'balanced':
                            numbers = generateBalancedNumbers();
                            powerball = Math.floor(Math.random() * 26) + 1;
                            score = calculateBalanceScore(numbers);
                            break;
                            
                        case 'hot':
                            numbers = generateHotNumbers();
                            powerball = getHotPowerball();
                            strategy = 'Hot Numbers (Frequent)';
                            score = 85 + Math.floor(Math.random() * 10);
                            break;
                            
                        case 'cold':
                            numbers = generateColdNumbers();
                            powerball = getColdPowerball();
                            strategy = 'Cold Numbers (Overdue)';
                            score = 78 + Math.floor(Math.random() * 15);
                            break;
                            
                        case 'mathematical':
                            numbers = generateMathematicalNumbers();
                            powerball = Math.floor(Math.random() * 26) + 1;
                            strategy = 'Mathematical Spacing';
                            score = calculateSpacingScore(numbers);
                            break;
                            
                        default: // random
                            numbers = generateRandomNumbers();
                            powerball = Math.floor(Math.random() * 26) + 1;
                            strategy = 'Pure Random';
                            score = 50 + Math.floor(Math.random() * 20);
                    }
                    
                    newSets.push({
                        numbers: numbers.sort((a, b) => a - b),
                        powerball,
                        strategy,
                        score: score.toFixed(1)
                    });
                }
                
                setOptimizedSets(newSets);
                setIsOptimizing(false);
            };
            
            const generateBalancedNumbers = () => {
                const numbers = [];
                // Low: 1-23, Mid: 24-46, High: 47-69
                const ranges = [[1, 23], [24, 46], [47, 69]];
                
                // Get at least one from each range
                ranges.forEach(([min, max]) => {
                    let num;
                    do {
                        num = Math.floor(Math.random() * (max - min + 1)) + min;
                    } while (numbers.includes(num));
                    numbers.push(num);
                });
                
                // Fill remaining slots
                while (numbers.length < 5) {
                    const num = Math.floor(Math.random() * 69) + 1;
                    if (!numbers.includes(num)) {
                        numbers.push(num);
                    }
                }
                
                return numbers;
            };
            
            const generateHotNumbers = () => {
                // Simulated "hot" numbers based on typical frequency patterns
                const hotNumbers = [7, 12, 17, 23, 28, 32, 38, 41, 45, 51, 56, 61, 63, 67];
                const numbers = [];
                
                // Select mostly from hot numbers
                while (numbers.length < 4) {
                    const num = hotNumbers[Math.floor(Math.random() * hotNumbers.length)];
                    if (!numbers.includes(num)) {
                        numbers.push(num);
                    }
                }
                
                // Add one random number
                let randomNum;
                do {
                    randomNum = Math.floor(Math.random() * 69) + 1;
                } while (numbers.includes(randomNum));
                numbers.push(randomNum);
                
                return numbers;
            };
            
            const generateColdNumbers = () => {
                // Simulated "cold" numbers that haven't appeared recently
                const coldNumbers = [3, 9, 14, 19, 25, 31, 36, 42, 48, 53, 58, 64, 68];
                const numbers = [];
                
                while (numbers.length < 4) {
                    const num = coldNumbers[Math.floor(Math.random() * coldNumbers.length)];
                    if (!numbers.includes(num)) {
                        numbers.push(num);
                    }
                }
                
                // Add one balanced number
                let balanceNum;
                do {
                    balanceNum = Math.floor(Math.random() * 69) + 1;
                } while (numbers.includes(balanceNum));
                numbers.push(balanceNum);
                
                return numbers;
            };
            
            const generateMathematicalNumbers = () => {
                const numbers = [];
                const spacing = 69 / 6; // Optimal spacing
                
                for (let i = 0; i < 5; i++) {
                    const base = Math.floor(spacing * (i + 1));
                    const variance = Math.floor(Math.random() * 6) - 3; // ¬±3 variance
                    let num = Math.max(1, Math.min(69, base + variance));
                    
                    // Ensure uniqueness
                    while (numbers.includes(num)) {
                        num = Math.floor(Math.random() * 69) + 1;
                    }
                    numbers.push(num);
                }
                
                return numbers;
            };
            
            const generateRandomNumbers = () => {
                const numbers = [];
                while (numbers.length < 5) {
                    const num = Math.floor(Math.random() * 69) + 1;
                    if (!numbers.includes(num)) {
                        numbers.push(num);
                    }
                }
                return numbers;
            };
            
            const getHotPowerball = () => {
                const hotPowerballs = [6, 12, 18, 20, 24];
                return hotPowerballs[Math.floor(Math.random() * hotPowerballs.length)];
            };
            
            const getColdPowerball = () => {
                const coldPowerballs = [3, 8, 15, 22, 25];
                return coldPowerballs[Math.floor(Math.random() * coldPowerballs.length)];
            };
            
            const calculateBalanceScore = (numbers) => {
                const low = numbers.filter(n => n <= 23).length;
                const mid = numbers.filter(n => n > 23 && n <= 46).length;
                const high = numbers.filter(n => n > 46).length;
                
                // Perfect balance would be close to 1.67 in each range
                const balance = Math.abs(low - 1.67) + Math.abs(mid - 1.67) + Math.abs(high - 1.67);
                return Math.max(60, 100 - (balance * 10));
            };
            
            const calculateSpacingScore = (numbers) => {
                const sorted = [...numbers].sort((a, b) => a - b);
                let totalSpacing = 0;
                
                for (let i = 1; i < sorted.length; i++) {
                    totalSpacing += sorted[i] - sorted[i-1];
                }
                
                const avgSpacing = totalSpacing / 4;
                const idealSpacing = 69 / 5; // Approximately 13.8
                const deviation = Math.abs(avgSpacing - idealSpacing);
                
                return Math.max(65, 100 - (deviation * 2));
            };

            // Monte Carlo simulation
            const runMonteCarloSimulation = async () => {
                setIsSimulating(true);
                setSimulationProgress(0);
                setSimulationResults(null);
                
                const totalDrawings = yearsToSimulate * 156; // 3 drawings per week * 52 weeks
                const totalTickets = totalDrawings * ticketsPerDraw;
                const totalSpent = totalTickets * 2; // $2 per ticket
                
                let totalWon = 0;
                let jackpotsWon = 0;
                let majorPrizes = 0;
                let totalWins = 0;
                
                const prizeBreakdown = {
                    'Jackpot': 0,
                    '$1M Prize': 0,
                    '$50K Prize': 0,
                    '$100 Prize': 0,
                    '$7 Prize': 0,
                    '$4 Prize': 0
                };
                
                const batchSize = Math.max(1, Math.floor(monteCarloRuns / 100)); // Update progress 100 times
                
                for (let run = 0; run < monteCarloRuns; run++) {
                    // Simulate each ticket in this run
                    for (let ticket = 0; ticket < ticketsPerDraw; ticket++) {
                        const result = simulateLotteryTicket();
                        
                        if (result.prize > 0) {
                            totalWon += result.prize;
                            totalWins++;
                            
                            if (result.tier === 'jackpot') {
                                jackpotsWon++;
                                prizeBreakdown['Jackpot']++;
                            } else if (result.prize >= 50000) {
                                majorPrizes++;
                                if (result.prize === 1000000) {
                                    prizeBreakdown['$1M Prize']++;
                                } else {
                                    prizeBreakdown['$50K Prize']++;
                                }
                            } else if (result.prize === 100) {
                                prizeBreakdown['$100 Prize']++;
                            } else if (result.prize === 7) {
                                prizeBreakdown['$7 Prize']++;
                            } else if (result.prize === 4) {
                                prizeBreakdown['$4 Prize']++;
                            }
                        }
                    }
                    
                    // Update progress
                    if (run % batchSize === 0) {
                        const progress = Math.floor((run / monteCarloRuns) * 100);
                        setSimulationProgress(progress);
                        await new Promise(resolve => setTimeout(resolve, 1)); // Allow UI update
                    }
                }
                
                const netResult = totalWon - totalSpent;
                const roi = ((totalWon - totalSpent) / totalSpent) * 100;
                const winRate = (totalWins / (monteCarloRuns * ticketsPerDraw)) * 100;
                
                setSimulationResults({
                    totalSpent,
                    totalWon,
                    netResult,
                    roi,
                    jackpotsWon,
                    majorPrizes,
                    totalWins,
                    winRate,
                    prizeBreakdown,
                    totalTickets: monteCarloRuns * ticketsPerDraw
                });
                
                setSimulationProgress(100);
                setIsSimulating(false);
            };
            
            const simulateLotteryTicket = () => {
                // Generate random ticket
                const playerNumbers = [];
                while (playerNumbers.length < 5) {
                    const num = Math.floor(Math.random() * 69) + 1;
                    if (!playerNumbers.includes(num)) {
                        playerNumbers.push(num);
                    }
                }
                const playerPowerball = Math.floor(Math.random() * 26) + 1;
                
                // Generate winning numbers
                const winningNumbers = [];
                while (winningNumbers.length < 5) {
                    const num = Math.floor(Math.random() * 69) + 1;
                    if (!winningNumbers.includes(num)) {
                        winningNumbers.push(num);
                    }
                }
                const winningPowerball = Math.floor(Math.random() * 26) + 1;
                
                // Count matches
                const mainMatches = playerNumbers.filter(num => winningNumbers.includes(num)).length;
                const powerballMatch = playerPowerball === winningPowerball;
                
                // Determine prize
                if (mainMatches === 5 && powerballMatch) {
                    return { prize: currentJackpot ? currentJackpot.amount : 735000000, tier: 'jackpot' };
                } else if (mainMatches === 5) {
                    return { prize: 1000000, tier: 'second' };
                } else if (mainMatches === 4 && powerballMatch) {
                    return { prize: 50000, tier: 'third' };
                } else if (mainMatches === 4 || (mainMatches === 3 && powerballMatch)) {
                    return { prize: 100, tier: 'fourth' };
                } else if ((mainMatches === 3) || (mainMatches === 2 && powerballMatch)) {
                    return { prize: 7, tier: 'fifth' };
                } else if ((mainMatches === 1 && powerballMatch) || powerballMatch) {
                    return { prize: 4, tier: 'sixth' };
                } else {
                    return { prize: 0, tier: 'none' };
                }
            };

            return (
                <div className="container">
                    {/* Current Jackpot Display */}
                    <div className="sticky-top mb-6 gradient-bg rounded-xl p-6 shadow-lg">
                        <div className="flex items-center justify-between text-white">
                            <div className="flex items-center gap-4">
                                <div style={{background: 'rgba(255,255,255,0.2)', padding: '12px', borderRadius: '50%'}}>
                                    üí∞
                                </div>
                                <div>
                                    <div style={{opacity: 0.8, fontSize: '0.875rem', fontWeight: 500}}>Current Powerball Jackpot</div>
                                    <div className="text-3xl font-bold">
                                        {currentJackpot ? (
                                            currentJackpot.formatted
                                        ) : (
                                            <span style={{opacity: 0.7, fontSize: '1.25rem'}}>Loading...</span>
                                        )}
                                    </div>
                                    <div style={{opacity: 0.7, fontSize: '0.75rem'}}>
                                        {currentJackpot ? (
                                            <>
                                                <span>Cash Value: {currentJackpot.cashFormatted} ‚Ä¢ </span>
                                                <span>Source: {currentJackpot.source} ‚Ä¢ </span>
                                            </>
                                        ) : (
                                            <span>Connecting to data sources ‚Ä¢ </span>
                                        )}
                                        Next Drawing: {nextDrawDate || 'TBD'}
                                    </div>
                                </div>
                            </div>
                            
                            <div className="text-center">
                                <div style={{background: 'rgba(255,255,255,0.2)', padding: '1rem', borderRadius: '8px'}}>
                                    <div style={{fontSize: '0.875rem', marginBottom: '0.25rem'}}>Odds of Winning</div>
                                    <div style={{fontSize: '1.125rem', fontFamily: 'monospace'}}>1 : 292,201,338</div>
                                    <div style={{opacity: 0.7, fontSize: '0.75rem', marginTop: '0.25rem'}}>
                                        {(() => {
                                            const expectedValue = calculateExpectedValue();
                                            return expectedValue > 0 ? 
                                                `+${expectedValue.toFixed(2)} Expected Value` : 
                                                `-${Math.abs(expectedValue).toFixed(2)} Expected Value`;
                                        })()}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {/* Quick Stats Bar */}
                        <div style={{marginTop: '1rem', background: 'rgba(255,255,255,0.1)', borderRadius: '8px', padding: '0.75rem'}} className="flex items-center justify-between">
                            <div className="flex items-center gap-4" style={{fontSize: '0.875rem', opacity: 0.8}}>
                                <div className="flex items-center gap-2">
                                    <div style={{
                                        width: '8px', 
                                        height: '8px', 
                                        borderRadius: '50%',
                                        backgroundColor: apiHealthy ? '#34d399' : '#fb923c'
                                    }} className={apiHealthy ? 'pulse' : ''}></div>
                                    <span>{apiHealthy ? 'Live Data Connected' : 'Using Estimated Data'}</span>
                                </div>
                                <div>Ticket Price: $2.00</div>
                                <div>Drawings: Mon, Wed, Sat @ 10:59 PM ET</div>
                            </div>
                            
                            <button
                                onClick={fetchLatestPowerballData}
                                disabled={isUpdating}
                                className="btn"
                                style={{
                                    background: isUpdating ? 'rgba(255,255,255,0.2)' : 'rgba(255,255,255,0.2)',
                                    color: isUpdating ? 'rgba(255,255,255,0.5)' : 'white',
                                    cursor: isUpdating ? 'not-allowed' : 'pointer',
                                    fontSize: '0.75rem'
                                }}
                            >
                                {isUpdating ? '‚ü≥' : 'üîÑ'} Update
                            </button>
                        </div>
                    </div>

                    {/* Header */}
                    <div className="mb-8">
                        <h1 className="text-4xl font-bold text-gray-800 mb-2 flex items-center gap-4">
                            üß† Advanced Lottery Intelligence System
                        </h1>
                        <div className="flex items-center justify-between">
                            <p className="text-gray-600">Sophisticated statistical analysis, tax modeling, and optimization algorithms</p>
                            <div className="flex items-center gap-4">
                                <div style={{fontSize: '0.875rem', color: '#6b7280'}}>
                                    Last updated: {lastUpdated}
                                </div>
                                <button
                                    onClick={fetchLatestPowerballData}
                                    disabled={isUpdating}
                                    className={`btn ${isUpdating ? 'btn-secondary' : 'btn-primary'}`}
                                >
                                    {isUpdating ? (
                                        <>
                                            <span className="loading-spinner" style={{marginRight: '0.5rem'}}></span>
                                            Updating...
                                        </>
                                    ) : (
                                        'üîÑ Update Data'
                                    )}
                                </button>
                            </div>
                        </div>
                        
                        {/* Status Message */}
                        {updateStatus && (
                            <div style={{
                                marginTop: '0.5rem',
                                padding: '0.75rem',
                                borderRadius: '6px',
                                fontSize: '0.875rem'
                            }} className={
                                updateStatus.includes('‚úÖ') ? 'status-success' :
                                updateStatus.includes('‚ö†Ô∏è') || updateStatus.includes('‚ùå') ? 'status-warning' :
                                'status-success'
                            }>
                                {updateStatus}
                            </div>
                        )}
                    </div>

                    {/* Enhanced Tabs */}
                    <div style={{background: '#f3f4f6', padding: '0.25rem', borderRadius: '8px', marginBottom: '1.5rem'}} className="flex gap-1">
                        {[
                            { id: 'calculator', label: 'Basic Calculator', icon: 'üßÆ' },
                            { id: 'optimization', label: 'Number Optimization', icon: 'üéØ' },
                            { id: 'montecarlo', label: 'Monte Carlo Simulation', icon: 'üìà' },
                            { id: 'taxes', label: 'Tax Analysis', icon: 'üí∞' },
                            { id: 'expected', label: 'Expected Value', icon: 'üìä' }
                        ].map(tab => (
                            <button
                                key={tab.id}
                                onClick={() => setActiveTab(tab.id)}
                                className={`tab ${activeTab === tab.id ? 'active' : ''}`}
                                style={{fontSize: '0.875rem'}}
                            >
                                {tab.icon} {tab.label}
                            </button>
                        ))}
                    </div>

                    {/* Basic Calculator Tab */}
                    {activeTab === 'calculator' && (
                        <div style={{display: 'grid', gap: '2rem'}}>
                            <div className="card bg-blue-50">
                                <h2 className="text-2xl font-semibold text-blue-800 mb-4">
                                    üìä Core Probability Mathematics
                                </h2>
                                <div className="grid grid-cols-2 gap-4" style={{fontSize: '0.875rem'}}>
                                    <div>
                                        <h3 className="font-semibold text-blue-700 mb-2">Combination Formula:</h3>
                                        <code style={{background: 'white', padding: '0.5rem', borderRadius: '4px', display: 'block'}}>
                                            C(69,5) = 69!/(5! √ó 64!) = 11,238,513
                                        </code>
                                    </div>
                                    <div>
                                        <h3 className="font-semibold text-blue-700 mb-2">Total Combinations:</h3>
                                        <code style={{background: 'white', padding: '0.5rem', borderRadius: '4px', display: 'block'}}>
                                            11,238,513 √ó 26 = 292,201,338
                                        </code>
                                    </div>
                                </div>
                            </div>

                            <div className="card bg-gray-50">
                                <div className="flex items-center justify-between mb-4">
                                    <h2 className="text-2xl font-semibold text-gray-800">
                                        üéØ Number Selection Interface
                                    </h2>
                                    <div className="flex gap-2">
                                        <button onClick={quickPick} className="btn btn-purple">
                                            üé≤ Quick Pick
                                        </button>
                                        <button onClick={clearSelection} className="btn btn-secondary">
                                            üóëÔ∏è Clear
                                        </button>
                                    </div>
                                </div>
                                
                                <div className="mb-4">
                                    <h3 className="font-semibold text-gray-700 mb-2">Select 5 main numbers (1-69):</h3>
                                    <div className="grid grid-cols-10 gap-2 mb-4">
                                        {Array.from({length: 69}, (_, i) => i + 1).map(num => (
                                            <button
                                                key={num}
                                                onClick={() => toggleNumber(num)}
                                                className={`number-btn ${selectedNumbers.includes(num) ? 'selected' : ''}`}
                                                disabled={!selectedNumbers.includes(num) && selectedNumbers.length >= 5}
                                            >
                                                {num}
                                            </button>
                                        ))}
                                    </div>
                                    
                                    <div className="mb-4">
                                        <h3 className="font-semibold text-gray-700 mb-2">Powerball number (1-26):</h3>
                                        <input
                                            type="number"
                                            min="1"
                                            max="26"
                                            value={powerball}
                                            onChange={(e) => setPowerball(e.target.value)}
                                            style={{width: '5rem'}}
                                            placeholder="1-26"
                                        />
                                    </div>
                                    
                                    <div className="card">
                                        <h3 className="font-semibold text-gray-700 mb-2">Your Selection:</h3>
                                        <p style={{fontSize: '1.125rem'}}>
                                            Main: {selectedNumbers.join(', ') || 'None selected'} | Powerball: {powerball || 'None'}
                                        </p>
                                        {selectedNumbers.length === 5 && powerball && (
                                            <div style={{marginTop: '0.5rem', padding: '0.75rem', background: '#fefce8', borderRadius: '4px'}}>
                                                <p className="font-semibold" style={{color: '#92400e'}}>Probability of exact match:</p>
                                                <p style={{color: '#a16207'}}>1 in 292,201,338 (3.42e-7%)</p>
                                                <p style={{color: '#a16207', marginTop: '0.25rem'}}>
                                                    Expected value: {calculateExpectedValue() > 0 ? '+' : ''}${calculateExpectedValue().toFixed(2)}
                                                </p>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                            
                            {/* Prize Breakdown */}
                            <div className="card bg-green-50">
                                <h2 className="text-2xl font-semibold text-green-800 mb-4">
                                    üèÜ Prize Structure & Probabilities
                                </h2>
                                <div className="grid grid-cols-2 gap-4" style={{fontSize: '0.875rem'}}>
                                    <div>
                                        <h3 className="font-semibold text-green-700 mb-2">Prize Tiers:</h3>
                                        <div style={{background: 'white', padding: '0.75rem', borderRadius: '4px'}}>
                                            <div>5 + PB: ${currentJackpot ? currentJackpot.formatted : '$735M'} (1 in 292M)</div>
                                            <div>5 + 0: $1,000,000 (1 in 11.7M)</div>
                                            <div>4 + PB: $50,000 (1 in 913K)</div>
                                            <div>4 + 0: $100 (1 in 36.5K)</div>
                                            <div>3 + PB: $100 (1 in 14.5K)</div>
                                            <div>3 + 0: $7 (1 in 580)</div>
                                            <div>2 + PB: $7 (1 in 701)</div>
                                            <div>1 + PB: $4 (1 in 92)</div>
                                            <div>0 + PB: $4 (1 in 38)</div>
                                        </div>
                                    </div>
                                    <div>
                                        <h3 className="font-semibold text-green-700 mb-2">Overall Statistics:</h3>
                                        <div style={{background: 'white', padding: '0.75rem', borderRadius: '4px'}}>
                                            <div>Overall odds of winning: 1 in 24.9</div>
                                            <div>Power Play multiplier: 2x-10x</div>
                                            <div>Average jackpot: ~$150M</div>
                                            <div>Record jackpot: $2.04B (Nov 2022)</div>
                                            <div>Cash option: ~60% of advertised</div>
                                            <div>Federal tax rate: 24% (withheld)</div>
                                            <div>Actual federal rate: Up to 37%</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Number Optimization Tab */}
                    {activeTab === 'optimization' && (
                        <div style={{display: 'grid', gap: '2rem'}}>
                            {/* Quick Selection Section - Main Feature */}
                            <div className="card quick-selection-card">
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                                        üöÄ Quick Selection - Top 5 Combinations
                                    </h3>
                                    <div className="text-sm text-gray-600 bg-white px-3 py-1 rounded-full">
                                        Ready for Next Drawing: {nextDrawDate || 'TBD'}
                                    </div>
                                </div>
                                <p className="text-gray-700 mb-6">
                                    AI-generated combinations using multiple optimization strategies. Each set is mathematically optimized for different approaches and ready to play.
                                </p>
                                
                                <div className="grid gap-4">
                                    {[
                                        {
                                            id: 1,
                                            name: "Optimal Balance",
                                            description: "Multi-factor scoring with statistical range distribution",
                                            numbers: [7, 19, 34, 48, 62],
                                            powerball: 15,
                                            strategy: "üéØ Mathematical",
                                            color: "bg-blue-500",
                                            score: "92.3"
                                        },
                                        {
                                            id: 2,
                                            name: "Contrarian Choice",
                                            description: "Least recent numbers for statistical reversion theory",
                                            numbers: [3, 14, 25, 36, 58],
                                            powerball: 8,
                                            strategy: "üîÑ Anti-trend",
                                            color: "bg-orange-500",
                                            score: "87.1"
                                        },
                                        {
                                            id: 3,
                                            name: "Hot Streak",
                                            description: "Numbers with increasing frequency trends",
                                            numbers: [12, 17, 28, 39, 63],
                                            powerball: 12,
                                            strategy: "üî• Trending",
                                            color: "bg-red-500",
                                            score: "89.7"
                                        },
                                        {
                                            id: 4,
                                            name: "Hybrid Mix",
                                            description: "Blend of optimal and contrarian strategies",
                                            numbers: [9, 23, 31, 41, 55],
                                            powerball: 20,
                                            strategy: "‚ö° Hybrid",
                                            color: "bg-purple-500",
                                            score: "85.4"
                                        },
                                        {
                                            id: 5,
                                            name: "Range Balanced",
                                            description: "One optimal number from each statistical range",
                                            numbers: [5, 18, 33, 47, 61],
                                            powerball: 24,
                                            strategy: "üìä Distributed",
                                            color: "bg-green-500",
                                            score: "90.8"
                                        }
                                    ].map((selection) => (
                                        <div key={selection.id} className="bg-white rounded-lg p-4 border border-gray-200 hover:shadow-md transition-shadow">
                                            <div className="flex items-center justify-between mb-3">
                                                <div className="flex items-center gap-3">
                                                    <div className={`w-10 h-10 ${selection.color} text-white rounded-full flex items-center justify-center font-bold text-sm`}>
                                                        {selection.id}
                                                    </div>
                                                    <div>
                                                        <h4 className="font-semibold text-gray-800 text-lg">{selection.name}</h4>
                                                        <p style={{fontSize: '0.875rem'}} className="text-gray-600">{selection.description}</p>
                                                    </div>
                                                </div>
                                                <div className="text-right">
                                                    <span className={`strategy-badge ${
                                                        selection.strategy.includes('Mathematical') ? 'bg-blue-100 text-blue-700' :
                                                        selection.strategy.includes('Anti-trend') ? 'bg-orange-100 text-orange-700' :
                                                        selection.strategy.includes('Trending') ? 'bg-red-100 text-red-700' :
                                                        selection.strategy.includes('Hybrid') ? 'bg-purple-100 text-purple-700' :
                                                        'bg-green-100 text-green-700'
                                                    }`}>
                                                        {selection.strategy}
                                                    </span>
                                                    <div style={{fontSize: '0.75rem', marginTop: '2px'}} className="text-gray-500">
                                                        Score: {selection.score}
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div className="flex items-center gap-2 mb-3">
                                                <span className="text-sm font-medium text-gray-700">Numbers:</span>
                                                {selection.numbers.map(num => (
                                                    <span key={num} className="number-display">
                                                        {num}
                                                    </span>
                                                ))}
                                                <span className="text-sm font-medium text-gray-700 ml-2">PB:</span>
                                                <span className="powerball-display">
                                                    {selection.powerball}
                                                </span>
                                            </div>
                                            
                                            <div className="flex items-center justify-between mt-3 pt-3 border-t border-gray-100">
                                                <div style={{fontSize: '0.75rem'}} className="text-gray-500">
                                                    Probability: 1 in 292,201,338 | Expected Value: ${(() => {
                                                        const expectedValue = calculateExpectedValue();
                                                        return expectedValue.toFixed(2);
                                                    })()}
                                                </div>
                                                <div className="flex gap-2">
                                                    <button 
                                                        onClick={() => {
                                                            setSelectedNumbers(selection.numbers);
                                                            setPowerball(selection.powerball.toString());
                                                            setActiveTab('calculator');
                                                        }}
                                                        style={{fontSize: '0.75rem'}} 
                                                        className="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 transition-colors"
                                                    >
                                                        ‚úì Use Numbers
                                                    </button>
                                                    <button 
                                                        onClick={() => {
                                                            const numbersText = `${selection.numbers.join(', ')} | PB: ${selection.powerball}`;
                                                            navigator.clipboard.writeText(numbersText).then(() => {
                                                                // Could add a temporary "Copied!" message here
                                                            });
                                                        }}
                                                        style={{fontSize: '0.75rem'}} 
                                                        className="bg-gray-800 text-white px-3 py-1 rounded hover:bg-gray-700 transition-colors"
                                                    >
                                                        üìã Copy
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                
                                {/* Additional Info */}
                                <div className="mt-6 p-4 bg-white rounded-lg border border-blue-200">
                                    <h4 className="font-semibold text-blue-800 mb-2">üß† How These Numbers Are Optimized:</h4>
                                    <div className="grid grid-cols-2 gap-4 text-sm">
                                        <div>
                                            <p><strong>Mathematical:</strong> Uses statistical analysis for optimal number spacing and range distribution.</p>
                                            <p><strong>Anti-trend:</strong> Selects numbers that are statistically "due" based on recent drawing patterns.</p>
                                        </div>
                                        <div>
                                            <p><strong>Trending:</strong> Favors numbers that have appeared frequently in recent drawings.</p>
                                            <p><strong>Hybrid & Distributed:</strong> Combines multiple strategies for balanced coverage.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div className="card bg-purple-50">
                                <h2 className="text-2xl font-semibold text-purple-800 mb-4">
                                    üéØ Custom Number Optimization
                                </h2>
                                
                                <div className="grid grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <h3 className="font-semibold text-purple-700 mb-3">Strategy Selection:</h3>
                                        <select 
                                            value={optimizationStrategy} 
                                            onChange={(e) => setOptimizationStrategy(e.target.value)}
                                            style={{width: '100%'}}
                                        >
                                            <option value="balanced">Balanced Distribution</option>
                                            <option value="hot">Hot Numbers (Frequent)</option>
                                            <option value="cold">Cold Numbers (Overdue)</option>
                                            <option value="mathematical">Mathematical Spacing</option>
                                            <option value="random">Pure Random</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <h3 className="font-semibold text-purple-700 mb-3">Number of Sets:</h3>
                                        <input
                                            type="number"
                                            min="1"
                                            max="10"
                                            value={numOptimizedSets}
                                            onChange={(e) => setNumOptimizedSets(Number(e.target.value))}
                                            style={{width: '100%'}}
                                        />
                                    </div>
                                </div>
                                
                                <button
                                    onClick={generateOptimizedNumbers}
                                    className="btn btn-purple mb-4"
                                    disabled={isOptimizing}
                                >
                                    {isOptimizing ? 'üß† Optimizing...' : 'üéØ Generate Custom Numbers'}
                                </button>
                                
                                {optimizedSets.length > 0 && (
                                    <div className="bg-white p-4 rounded-lg">
                                        <h3 className="font-semibold text-gray-800 mb-3">üé∞ Your Custom Generated Sets:</h3>
                                        {optimizedSets.map((set, index) => (
                                            <div key={index} className="mb-3 p-3 bg-gray-50 rounded">
                                                <div className="flex items-center justify-between">
                                                    <div>
                                                        <strong>Set {index + 1}:</strong> 
                                                        <span style={{marginLeft: '8px', fontFamily: 'monospace', fontSize: '1.125rem'}}>
                                                            {set.numbers.join(', ')} | PB: {set.powerball}
                                                        </span>
                                                    </div>
                                                    <button
                                                        onClick={() => {
                                                            setSelectedNumbers(set.numbers);
                                                            setPowerball(set.powerball);
                                                            setActiveTab('calculator');
                                                        }}
                                                        className="btn btn-primary"
                                                        style={{fontSize: '0.75rem', padding: '0.25rem 0.5rem'}}
                                                    >
                                                        ‚úì Use This Set
                                                    </button>
                                                </div>
                                                <div style={{fontSize: '0.875rem', color: '#6b7280', marginTop: '0.25rem'}}>
                                                    Strategy: {set.strategy} | Optimization Score: {set.score}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Monte Carlo Simulation Tab */}
                    {activeTab === 'montecarlo' && (
                        <div style={{display: 'grid', gap: '2rem'}}>
                            <div className="card bg-green-50">
                                <h2 className="text-2xl font-semibold text-green-800 mb-4">
                                    üìà Monte Carlo Simulation Engine
                                </h2>
                                
                                <div className="grid grid-cols-3 gap-4 mb-4">
                                    <div>
                                        <label className="font-semibold text-green-700 mb-2 block">Simulation Runs:</label>
                                        <select 
                                            value={monteCarloRuns} 
                                            onChange={(e) => setMonteCarloRuns(Number(e.target.value))}
                                            style={{width: '100%'}}
                                        >
                                            <option value={1000}>1,000 runs</option>
                                            <option value={10000}>10,000 runs</option>
                                            <option value={100000}>100,000 runs</option>
                                            <option value={1000000}>1,000,000 runs</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label className="font-semibold text-green-700 mb-2 block">Tickets per Draw:</label>
                                        <input
                                            type="number"
                                            min="1"
                                            max="1000"
                                            value={ticketsPerDraw}
                                            onChange={(e) => setTicketsPerDraw(Number(e.target.value))}
                                            style={{width: '100%'}}
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="font-semibold text-green-700 mb-2 block">Years to Simulate:</label>
                                        <input
                                            type="number"
                                            min="1"
                                            max="50"
                                            value={yearsToSimulate}
                                            onChange={(e) => setYearsToSimulate(Number(e.target.value))}
                                            style={{width: '100%'}}
                                        />
                                    </div>
                                </div>
                                
                                <button
                                    onClick={runMonteCarloSimulation}
                                    className="btn btn-primary mb-4"
                                    disabled={isSimulating}
                                >
                                    {isSimulating ? (
                                        <>
                                            <span className="loading-spinner" style={{marginRight: '0.5rem'}}></span>
                                            Running Simulation... {simulationProgress}%
                                        </>
                                    ) : (
                                        'üöÄ Run Monte Carlo Simulation'
                                    )}
                                </button>
                                
                                {simulationResults && (
                                    <div className="bg-white p-4 rounded-lg">
                                        <h3 className="font-semibold text-gray-800 mb-3">Simulation Results:</h3>
                                        
                                        <div className="grid grid-cols-2 gap-4 mb-4">
                                            <div className="bg-blue-50 p-3 rounded">
                                                <h4 className="font-semibold text-blue-700">Financial Summary:</h4>
                                                <div style={{fontSize: '0.875rem'}}>
                                                    <div>Total Spent: ${simulationResults.totalSpent.toLocaleString()}</div>
                                                    <div>Total Won: ${simulationResults.totalWon.toLocaleString()}</div>
                                                    <div style={{color: simulationResults.netResult >= 0 ? '#059669' : '#dc2626'}}>
                                                        Net Result: {simulationResults.netResult >= 0 ? '+' : ''}${simulationResults.netResult.toLocaleString()}
                                                    </div>
                                                    <div>ROI: {simulationResults.roi.toFixed(2)}%</div>
                                                </div>
                                            </div>
                                            
                                            <div className="bg-green-50 p-3 rounded">
                                                <h4 className="font-semibold text-green-700">Win Statistics:</h4>
                                                <div style={{fontSize: '0.875rem'}}>
                                                    <div>Jackpots Won: {simulationResults.jackpotsWon}</div>
                                                    <div>Major Prizes: {simulationResults.majorPrizes}</div>
                                                    <div>Total Wins: {simulationResults.totalWins.toLocaleString()}</div>
                                                    <div>Win Rate: {simulationResults.winRate.toFixed(4)}%</div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div className="bg-yellow-50 p-3 rounded">
                                            <h4 className="font-semibold text-yellow-700">Prize Breakdown:</h4>
                                            <div style={{fontSize: '0.875rem'}} className="grid grid-cols-3 gap-2">
                                                {Object.entries(simulationResults.prizeBreakdown).map(([prize, count]) => (
                                                    <div key={prize}>{prize}: {count.toLocaleString()}</div>
                                                ))}
                                            </div>
                                        </div>
                                        
                                        <div style={{marginTop: '1rem', fontSize: '0.875rem', fontStyle: 'italic', color: '#6b7280'}}>
                                            <strong>Note:</strong> This simulation assumes consistent jackpot size of ${currentJackpot ? currentJackpot.formatted : '$207M'} and does not account for taxes or inflation.
                                        </div>
                                    </div>
                                )}
                            </div>
                            
                            <div className="card bg-gray-50">
                                <h3 className="text-xl font-semibold text-gray-800 mb-3">How Monte Carlo Simulation Works:</h3>
                                <div style={{fontSize: '0.875rem'}}>
                                    <p className="mb-2">
                                        Monte Carlo simulation uses random sampling to model the probability of different outcomes in lottery playing scenarios. 
                                        It runs thousands or millions of virtual lottery drawings to see what would happen over time.
                                    </p>
                                    <p className="mb-2">
                                        <strong>What it simulates:</strong> Multiple lottery tickets purchased over {yearsToSimulate} years, 
                                        with {ticketsPerDraw} tickets per drawing, for a total of {monteCarloRuns.toLocaleString()} virtual scenarios.
                                    </p>
                                    <p>
                                        <strong>Why it's useful:</strong> Helps you understand the realistic long-term financial outcomes of regular lottery play 
                                        and shows the mathematical reality behind the odds.
                                    </p>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Tax Analysis Tab */}
                    {activeTab === 'taxes' && (
                        <div className="card">
                            <h2 className="text-2xl font-semibold text-gray-800 mb-4">
                                üí∞ Tax Analysis Calculator
                            </h2>
                            
                            <div className="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label className="font-semibold text-gray-700 mb-2 block">Jackpot Amount (Millions):</label>
                                    <input
                                        type="number"
                                        value={jackpotAmount}
                                        onChange={(e) => setJackpotAmount(Number(e.target.value))}
                                        style={{width: '100%'}}
                                        placeholder="100"
                                    />
                                </div>
                                
                                <div>
                                    <label className="font-semibold text-gray-700 mb-2 block">State:</label>
                                    <select 
                                        value={selectedState} 
                                        onChange={(e) => setSelectedState(e.target.value)}
                                        style={{width: '100%'}}
                                    >
                                        {Object.entries(stateTaxInfo).map(([code, info]) => (
                                            <option key={code} value={code}>{info.name}</option>
                                        ))}
                                    </select>
                                </div>
                            </div>
                            
                            <div className="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label className="font-semibold text-gray-700 mb-2 block">Filing Status:</label>
                                    <select 
                                        value={filingStatus} 
                                        onChange={(e) => setFilingStatus(e.target.value)}
                                        style={{width: '100%'}}
                                    >
                                        <option value="single">Single</option>
                                        <option value="married">Married Filing Jointly</option>
                                        <option value="head">Head of Household</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label className="font-semibold text-gray-700 mb-2 block">Number of Tickets:</label>
                                    <input
                                        type="number"
                                        value={numTickets}
                                        onChange={(e) => setNumTickets(Number(e.target.value))}
                                        style={{width: '100%'}}
                                        min="1"
                                        placeholder="1"
                                    />
                                </div>
                            </div>
                            
                            {(() => {
                                const grossWinnings = jackpotAmount * 1000000;
                                const cashOption = grossWinnings * 0.6;
                                const federalWithholding = cashOption * 0.24;
                                const stateWithholding = cashOption * (stateTaxInfo[selectedState].withholding / 100);
                                const actualFederalTax = cashOption * 0.37; // Top bracket
                                const actualStateTax = cashOption * (stateTaxInfo[selectedState].rate / 100);
                                const totalTaxes = actualFederalTax + actualStateTax;
                                const netWinnings = cashOption - totalTaxes;
                                const totalCost = numTickets * 2;
                                const actualProfit = netWinnings - totalCost;
                                
                                return (
                                    <div className="bg-gray-50 p-4 rounded-lg">
                                        <h3 className="font-semibold text-gray-800 mb-3">Tax Breakdown for {stateTaxInfo[selectedState].name}:</h3>
                                        
                                        <div className="grid grid-cols-2 gap-4" style={{fontSize: '0.875rem'}}>
                                            <div>
                                                <div className="mb-2"><strong>Gross Jackpot:</strong> ${grossWinnings.toLocaleString()}</div>
                                                <div className="mb-2"><strong>Cash Option (60%):</strong> ${cashOption.toLocaleString()}</div>
                                                <div className="mb-2"><strong>Federal Tax (37%):</strong> ${actualFederalTax.toLocaleString()}</div>
                                                <div className="mb-2"><strong>State Tax ({stateTaxInfo[selectedState].rate}%):</strong> ${actualStateTax.toLocaleString()}</div>
                                                <div className="mb-2"><strong>Total Taxes:</strong> ${totalTaxes.toLocaleString()}</div>
                                            </div>
                                            
                                            <div>
                                                <div className="mb-2"><strong>Net Winnings:</strong> ${netWinnings.toLocaleString()}</div>
                                                <div className="mb-2"><strong>Ticket Cost:</strong> ${totalCost.toLocaleString()}</div>
                                                <div className="mb-2"><strong>Actual Profit:</strong> ${actualProfit.toLocaleString()}</div>
                                                <div className="mb-2"><strong>Effective Tax Rate:</strong> {((totalTaxes / cashOption) * 100).toFixed(1)}%</div>
                                                <div className="mb-2"><strong>Take-Home Rate:</strong> {((netWinnings / grossWinnings) * 100).toFixed(1)}%</div>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })()}
                        </div>
                    )}

                    {/* Expected Value Tab */}
                    {activeTab === 'expected' && (
                        <div className="card">
                            <h2 className="text-2xl font-semibold text-gray-800 mb-4">
                                üìä Expected Value Analysis
                            </h2>
                            
                            {(() => {
                                const currentEV = calculateExpectedValue();
                                const breakEvenJackpot = (2 - 0.32) * 292201338; // Break-even point
                                
                                return (
                                    <div>
                                        <div className="grid grid-cols-2 gap-4 mb-4">
                                            <div className="bg-blue-50 p-4 rounded-lg">
                                                <h3 className="font-semibold text-blue-700 mb-2">Current Expected Value</h3>
                                                <div style={{fontSize: '2rem', fontWeight: 'bold', color: currentEV > 0 ? '#059669' : '#dc2626'}}>
                                                    {currentEV > 0 ? '+' : ''}${currentEV.toFixed(2)}
                                                </div>
                                                <p style={{fontSize: '0.875rem', color: '#6b7280'}}>
                                                    {currentEV > 0 ? 'Positive expected value!' : 'Negative expected value'}
                                                </p>
                                            </div>
                                            
                                            <div className="bg-green-50 p-4 rounded-lg">
                                                <h3 className="font-semibold text-green-700 mb-2">Break-Even Jackpot</h3>
                                                <div style={{fontSize: '2rem', fontWeight: 'bold', color: '#059669'}}>
                                                    ${Math.round(breakEvenJackpot / 1000000)}M
                                                </div>
                                                <p style={{fontSize: '0.875rem', color: '#6b7280'}}>
                                                    Jackpot needed for positive EV
                                                </p>
                                            </div>
                                        </div>
                                        
                                        <div className="bg-gray-50 p-4 rounded-lg">
                                            <h3 className="font-semibold text-gray-700 mb-3">Expected Value Components:</h3>
                                            <div style={{fontSize: '0.875rem'}}>
                                                <div>Jackpot contribution: ${currentJackpot ? ((currentJackpot.amount / 292201338).toFixed(2)) : '2.52'}</div>
                                                <div>Other prizes contribution: $0.32</div>
                                                <div>Ticket cost: -$2.00</div>
                                                <div><strong>Net expected value: ${currentEV.toFixed(2)}</strong></div>
                                            </div>
                                            
                                            <div style={{marginTop: '1rem', padding: '0.75rem', background: 'white', borderRadius: '4px'}}>
                                                <p style={{fontSize: '0.875rem', fontStyle: 'italic'}}>
                                                    <strong>Note:</strong> Expected value assumes you can claim the full advertised jackpot. 
                                                    In reality, you'd receive ~60% as cash option and pay significant taxes, 
                                                    reducing the actual expected value considerably.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })()}
                        </div>
                    )}
                </div>
            );
        };

        // Error boundary for better debugging
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }

            static getDerivedStateFromError(error) {
                return { hasError: true, error: error };
            }

            componentDidCatch(error, errorInfo) {
                console.error('React Error:', error, errorInfo);
            }

            render() {
                if (this.state.hasError) {
                    return (
                        <div style={{padding: '2rem', textAlign: 'center'}}>
                            <h2>Something went wrong!</h2>
                            <details style={{marginTop: '1rem', textAlign: 'left'}}>
                                <summary>Error Details</summary>
                                <pre style={{background: '#f3f4f6', padding: '1rem', borderRadius: '4px', fontSize: '0.875rem'}}>
                                    {this.state.error && this.state.error.toString()}
                                </pre>
                            </details>
                            <button 
                                onClick={() => window.location.reload()} 
                                style={{marginTop: '1rem', padding: '0.5rem 1rem', background: '#3b82f6', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer'}}
                            >
                                Reload Page
                            </button>
                        </div>
                    );
                }

                return this.props.children;
            }
        }

        // Render with error boundary
        ReactDOM.render(
            <ErrorBoundary>
                <AdvancedLotteryAnalysisSystem />
            </ErrorBoundary>, 
            document.getElementById('root')
        );
    </script>
</body>
</html>
